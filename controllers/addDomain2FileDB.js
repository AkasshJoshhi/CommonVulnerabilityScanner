var fs = require('fs');


async function appendNewData(updatedDataObj,domainName){
    updatedDataObj.domainArray.push(domainName);
    updatedDataObj.subd["probedSubd"][`${domainName}`]=[];
    updatedDataObj.subd["enumSubd"][`${domainName}`]=[];
    expAndChecklistObjectKeys = Object.keys(updatedDataObj.exploits);
//  ^^^ checklistObjectKeys = exploitObjectKeys;

    expAndChecklistObjectKeys.forEach(element => {
        updatedDataObj[`exploits`][`${element}`][`${domainName}`]={};  // Object for exploits
        updatedDataObj[`checklist`][`${element}`][`${domainName}`]=[]; // Array for checklisting
    });
    
}
 function writeUpdate2Original(jsonDbFilePath,updatedDataObj){
     fs.writeFileSync(jsonDbFilePath,JSON.stringify(updatedDataObj), 'utf-8');
     console.log(updatedDataObj)
}

module.exports= async function addDomain2FileDB(dbData,domainName){
    var jsonDbFilePath = require('../config/config').database.dbFilePath;
    var updatedDataObj={...dbData};
    console.log("---> addingDomain2FileDB");
    try{
        await appendNewData(updatedDataObj,domainName);
        writeUpdate2Original(jsonDbFilePath,updatedDataObj);
    }
    catch(e){
        console.log(e.message);
    }
}
